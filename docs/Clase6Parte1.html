<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Clase 5: Modelos de distribución potencial de especies (SDMs)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Clase6Parte1_files/libs/clipboard/clipboard.min.js"></script>
<script src="Clase6Parte1_files/libs/quarto-html/quarto.js"></script>
<script src="Clase6Parte1_files/libs/quarto-html/popper.min.js"></script>
<script src="Clase6Parte1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Clase6Parte1_files/libs/quarto-html/anchor.min.js"></script>
<link href="Clase6Parte1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Clase6Parte1_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Clase6Parte1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Clase6Parte1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Clase6Parte1_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Clase 5: Modelos de distribución potencial de especies (SDMs)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Los Modelos de Distribución de Especies (Species Distribution Models o SDMs) son herramientas estadísticas y computacionales que nos permiten predecir la distribución geográfica de una especie a partir de datos de ocurrencia (presencia o presencia/ausencia) y variables ambientales (como clima, topografía, vegetación, etc.).</p>
<p><a href="https://doi.org/10.1111/ecog.05877">Species distribution models rarely predict the biology of real populations</a></p>
<p><strong>Glosario de términos</strong></p>
<ul>
<li><p>Abundancia: Número de individuos de una especie presentes en un sitio.</p></li>
<li><p>AUC: Área bajo la curva ROC (característica operativa del receptor). Es una medida de la capacidad de discriminación del modelo independiente de umbrales. Varía entre 0 y 1, donde un valor de 0.5 indica un modelo que no predice mejor que el azar la presencia o ausencia.</p></li>
<li><p>Calibración: Se refiere con frecuencia a la validación interna de los SDMs durante su construcción (ver validación cruzada). Con datos independientes, el “desempeño de calibración” se refiere al grado de correlación entre las predicciones del SDM y la probabilidad de ocurrencia cuantificada en encuestas independientes, por ejemplo, si los sitios con una probabilidad predicha de 0.60 tienen un 60% de probabilidad de estar ocupados, y si esto es el doble de probable que en sitios con una probabilidad predicha de 0.30 (Vaughan y Ormerod 2005).</p></li>
<li><p>SDM: Se utiliza aquí para referirse tanto a los Modelos de Distribución de Especies (SDMs) como a los Modelos de Nicho Ecológico (ENMs), ambos de naturaleza correlacional.</p></li>
<li><p>Predicción de SDM: Salida del SDM para cada celda en la región de estudio. Dependiendo del algoritmo del modelo, esta salida puede representar probabilidad de ocurrencia o idoneidad del hábitat, aunque en muchos casos se transforma o interpreta como idoneidad relativa del hábitat.</p></li>
<li><p>Error de comisión: Predecir la presencia de una especie en un lugar donde en realidad está ausente (falso positivo).</p></li>
<li><p>Validación cruzada: Evaluación de la capacidad del SDM para predecir presencias y ausencias utilizando una porción retenida de los datos de localidad usados para construir el modelo.</p></li>
<li><p>Capacidad de discriminación: Habilidad del SDM para distinguir correctamente las presencias y ausencias observadas de una especie en la región de estudio.</p></li>
<li><p>Limitación por dispersión: Ausencia de individuos en ciertos lugares debido a barreras fisiológicas o físicas al movimiento, o por tiempo insuficiente para colonizar.</p></li>
<li><p>Distancia al centroide del nicho (según Lira-Noriega y Manthey 2014): Medida calculada extrayendo las condiciones ambientales subyacentes en todos los sitios dentro del rango geográfico predicho por el SDM; se estima el centroide multivariado de este espacio ambiental y se calcula la distancia geométrica entre una localidad de interés y este centroide en el espacio ambiental. Nota: en otros estudios, los datos ambientales se extraen inicialmente de observaciones de la especie u otras estimaciones del rango (es decir, no basado en predicciones de SDM).</p></li>
<li><p>Nicho ecológico: Tiene muchas definiciones; ver Chase y Leopold (2003) para una revisión, y Soberón (2007) para una discusión en el contexto de los SDMs. Muchos parámetros en esta revisión se refieren al nicho demográfico: condiciones ambientales que permiten un crecimiento poblacional intrínseco no negativo.</p></li>
<li><p>Tasa finita de crecimiento (lambda): Tasa de crecimiento per cápita de una población, medida como la razón del tamaño poblacional entre dos intervalos de tiempo consecutivos.</p></li>
<li><p>Diversidad genética: Diversidad de alelos y genotipos dentro de una población, representada por la riqueza alélica, diversidad de nucleótidos, heterocigosidad, coeficientes de endogamia y/o relaciones de parentesco.</p></li>
<li><p>Idoneidad del hábitat: Capacidad y grado en que las condiciones ambientales pueden sostener poblaciones viables.</p></li>
<li><p>Datos independientes: Mediciones del rango geográfico, ocurrencia, abundancia, aptitud promedio poblacional o diversidad genética recogidas independientemente de los registros de ocurrencia usados para construir SDMs. Idealmente, no incluyen sesgos espaciales u otros, y se recolectan en sitios que abarcan todo el rango de predicciones del SDM.</p></li>
<li><p>Aptitud individual: Existen múltiples definiciones, unificadas por el objetivo de evaluar la capacidad relativa de un individuo para pasar sus genes a la siguiente generación.</p></li>
<li><p>Tasa intrínseca de crecimiento (r): Máxima tasa de crecimiento per cápita para una población.</p></li>
<li><p>Ocurrencia: Presencia de una especie dada en un sitio dado. Los conjuntos de datos de ocurrencia pueden incluir tanto presencias como ausencias.</p></li>
<li><p>Errores de omisión: Predecir la ausencia de una especie en un lugar donde en realidad está presente (falso negativo).</p></li>
<li><p>Aptitud promedio poblacional (λ): Aptitud promediada entre todos los individuos de una población.</p></li>
<li><p>Posición en el rango: Posición de un sitio con respecto al centro o a los bordes de la distribución geográfica de una especie.</p></li>
<li><p>ROC: Curva característica operativa del receptor. Se grafica la sensibilidad contra 1-especificidad para cada posible umbral de ocurrencia.</p></li>
<li><p>SDM y ENM (modelo de distribución de especies y modelo de nicho ecológico): Términos utilizados para describir modelos correlacionales que asocian variables ambientales con ocurrencias conocidas de especies (revisado en Peterson 2011, Peterson y Soberón 2012). Aunque en teoría y en la práctica ideal, modelar la distribución no es lo mismo que modelar el nicho (Pulliam 2000, Peterson 2011, Peterson y Soberón 2012), los autores utilizan ambos términos al generar modelos para predecir los parámetros revisados aquí.</p></li>
<li><p>Sensibilidad: Proporción de presencias observadas que fueron correctamente predichas como presentes por el SDM.</p></li>
<li><p>Especificidad: Proporción de ausencias observadas que fueron correctamente predichas como ausentes por el SDM.</p></li>
<li><p>Tasa de verdaderos positivos: Proporción de presencias observadas que fueron predichas como presentes por el SDM.</p></li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Selección de las Especies y de los Datos de Presencia y Ausencia</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Selección de Variables Ambientales</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Preparación y Preprocesamiento de los Datos</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">La colinealidad</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false" href="">Seleccionar variables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false" href="">Construcción del Modelo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false" href="">Evaluación del Modelo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-8" role="tab" aria-controls="tabset-1-8" aria-selected="false" href="">Validación y Ajuste del Modelo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-9" role="tab" aria-controls="tabset-1-9" aria-selected="false" href="">Predicción de la Distribución Potencial</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-10" role="tab" aria-controls="tabset-1-10" aria-selected="false" href="">Interpretación y Aplicación de los Resultados</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Datos de presencia: Son los puntos geográficos donde se ha registrado la presencia de la especie. Estos datos deben ser lo más precisos posible y cubrir una amplia gama de condiciones ambientales donde la especie podría encontrarse.</p>
<p>Datos de ausencia: Es importante contar con puntos donde se ha confirmado que la especie no está presente, aunque en muchos casos estos datos se generan a través de técnicas de muestreo sistemático o métodos de pseudo-ausencia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geodata)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>SETCHR <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/ebd_HN_gchwar_201701_201912_smp_relAug-2023.txt"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>SETCHR1 <span class="ot">&lt;-</span> SETCHR <span class="sc">%&gt;%</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"Observaciones"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">OBSERVATION COUNT</span><span class="st">`</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Fecha"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">OBSERVATION DATE</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Observaciones =</span> <span class="fu">as.numeric</span>(Observaciones)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Observaciones <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(Fecha)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="st">"2018"</span> <span class="sc">|</span> Year <span class="sc">==</span> <span class="st">"2019"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Year, Fecha, Observaciones, LONGITUDE, LATITUDE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Las variables ambientales son factores que influyen en la distribución de la especie, como temperatura, precipitación, tipo de vegetación, altitud, entre otras. En este paso se seleccionan las variables que son relevantes para la especie en estudio.</p>
<p>Datos espaciales como imágenes satelitales, mapas de uso del suelo, o bases de datos climáticas (por ejemplo, WorldClim, CHELSA) pueden ser utilizadas para obtener las capas raster que representan estas variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>output_path <span class="ot">&lt;-</span> <span class="st">"data/"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>HN_clim.current <span class="ot">&lt;-</span> geodata<span class="sc">::</span><span class="fu">worldclim_country</span>(<span class="st">"HN"</span>, <span class="at">var =</span> <span class="st">"bio"</span>, <span class="at">path =</span> output_path)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>HN_clim.current_raster <span class="ot">&lt;-</span> <span class="fu">as</span>(HN_clim.current, <span class="st">"Raster"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Homogeneización de resoluciones: Asegurarse de que todas las capas de variables ambientales tengan la misma resolución espacial y cobertura geográfica.</p>
<p>Manejo de datos faltantes: Es fundamental abordar los valores faltantes, ya sea imputándolos o eliminando las observaciones incompletas.</p>
<p>Transformación de las variables: Algunas variables pueden necesitar ser transformadas (por ejemplo, a través de logaritmos o escalado) para mejorar la relación con la presencia de la especie.</p>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>Ocurre cuando dos o más variables predictoras están altamente correlacionadas entre sí, lo que puede afectar la estabilidad y la interpretación de los modelos. Para verificar la colinealidad entre las variables ambientales, se puede calcular el Índice de Inflación de la Varianza (VIF). Un VIF alto (generalmente &gt; 10) indica una alta colinealidad y sugiere que esas variables pueden estar proporcionando información redundante al modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Variables <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">as.data.frame</span>(HN_clim.current_raster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>GGally<span class="sc">::</span><span class="fu">ggcorr</span>(Variables)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Clase6Parte1_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Modelo1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wc2<span class="fl">.1</span>_30s_bio_1 <span class="sc">~</span> wc2<span class="fl">.1</span>_30s_bio_1 <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_2 <span class="sc">+</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_3 <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_4 <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_5 <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_6 <span class="sc">+</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_7 <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_8 <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_9 <span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_10 <span class="sc">+</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_11 <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_12 <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_13 <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_14 <span class="sc">+</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_15 <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_16 <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_17 <span class="sc">+</span> </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_18 <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_19,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> Variables)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_collinearity</span>(Modelo1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for Multicollinearity

Low Correlation

             Term  VIF         VIF 95% CI Increased SE Tolerance
 wc2.1_30s_bio_18 3.89 [   3.87,    3.91]         1.97      0.26
 Tolerance 95% CI
     [0.26, 0.26]

Moderate Correlation

             Term  VIF         VIF 95% CI Increased SE Tolerance
 wc2.1_30s_bio_19 6.38 [   6.33,    6.42]         2.52      0.16
 Tolerance 95% CI
     [0.16, 0.16]

High Correlation

             Term     VIF         VIF 95% CI Increased SE Tolerance
  wc2.1_30s_bio_2 1172.72 [1164.21, 1181.29]        34.24  8.53e-04
  wc2.1_30s_bio_3   74.20 [  73.66,   74.74]         8.61      0.01
  wc2.1_30s_bio_4  175.89 [ 174.61,  177.17]        13.26  5.69e-03
  wc2.1_30s_bio_5 1286.11 [1276.77, 1295.51]        35.86  7.78e-04
  wc2.1_30s_bio_6 1778.76 [1765.85, 1791.76]        42.18  5.62e-04
  wc2.1_30s_bio_8   34.12 [  33.87,   34.36]         5.84      0.03
  wc2.1_30s_bio_9   56.51 [  56.10,   56.92]         7.52      0.02
 wc2.1_30s_bio_10 2036.20 [2021.42, 2051.09]        45.12  4.91e-04
 wc2.1_30s_bio_11 2197.26 [2181.31, 2213.33]        46.87  4.55e-04
 wc2.1_30s_bio_12   74.02 [  73.49,   74.56]         8.60      0.01
 wc2.1_30s_bio_13   57.55 [  57.14,   57.97]         7.59      0.02
 wc2.1_30s_bio_14   55.89 [  55.49,   56.30]         7.48      0.02
 wc2.1_30s_bio_15   19.61 [  19.47,   19.74]         4.43      0.05
 wc2.1_30s_bio_16   71.50 [  70.99,   72.02]         8.46      0.01
 wc2.1_30s_bio_17   92.44 [  91.77,   93.11]         9.61      0.01
 Tolerance 95% CI
     [0.00, 0.00]
     [0.01, 0.01]
     [0.01, 0.01]
     [0.00, 0.00]
     [0.00, 0.00]
     [0.03, 0.03]
     [0.02, 0.02]
     [0.00, 0.00]
     [0.00, 0.00]
     [0.01, 0.01]
     [0.02, 0.02]
     [0.02, 0.02]
     [0.05, 0.05]
     [0.01, 0.01]
     [0.01, 0.01]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Modelo1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wc2<span class="fl">.1</span>_30s_bio_1 <span class="sc">~</span> wc2<span class="fl">.1</span>_30s_bio_1 <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_3 <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_7 <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_8 <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_15 <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_16 <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_18 <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                wc2<span class="fl">.1</span>_30s_bio_19,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> Variables)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_collinearity</span>(Modelo1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for Multicollinearity

Low Correlation

             Term  VIF   VIF 95% CI Increased SE Tolerance Tolerance 95% CI
  wc2.1_30s_bio_3 2.29 [2.28, 2.31]         1.51      0.44     [0.43, 0.44]
  wc2.1_30s_bio_7 2.34 [2.33, 2.35]         1.53      0.43     [0.42, 0.43]
  wc2.1_30s_bio_8 1.70 [1.69, 1.71]         1.30      0.59     [0.59, 0.59]
 wc2.1_30s_bio_15 2.62 [2.61, 2.64]         1.62      0.38     [0.38, 0.38]
 wc2.1_30s_bio_16 3.64 [3.61, 3.66]         1.91      0.27     [0.27, 0.28]
 wc2.1_30s_bio_18 2.69 [2.67, 2.70]         1.64      0.37     [0.37, 0.37]
 wc2.1_30s_bio_19 2.59 [2.57, 2.60]         1.61      0.39     [0.38, 0.39]</code></pre>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>HN_clim.current_raster2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(HN_clim.current_raster, <span class="fu">c</span>(<span class="st">"wc2.1_30s_bio_3"</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"wc2.1_30s_bio_7"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"wc2.1_30s_bio_8"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"wc2.1_30s_bio_15"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"wc2.1_30s_bio_16"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"wc2.1_30s_bio_18"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"wc2.1_30s_bio_19"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<p>Utilizando métodos estadísticos y de aprendizaje automático, se ajustan los modelos de distribución potencial. Algunos de los métodos más comunes son:</p>
<p>Modelos de Regresión Logística (GLM).</p>
<p>Máquinas de Vectores de Soporte (SVM).</p>
<p>Redes Neuronales Artificiales (ANN).</p>
<p>Random Forest (RF).</p>
<p>MaxEnt (Maximum Entropy).</p>
<p>El modelo se ajusta a partir de los datos de presencia y ausencia utilizando las variables ambientales seleccionadas.</p>
<p><a href="https://doi.org/10.1111/2041-210X.12841">ssdm: An r package to predict distribution of species richness and composition based on stacked species distribution models</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SSDM)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>sdrf <span class="ot">&lt;-</span> <span class="fu">modelling</span>(<span class="at">algorithm =</span> <span class="st">'RF'</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Env =</span> HN_clim.current_raster2, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Occurrences =</span> SETCHR1,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Xcol =</span> <span class="st">'LONGITUDE'</span>, </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Ycol =</span> <span class="st">'LATITUDE'</span>, </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">metric =</span> <span class="st">'TSS'</span>, </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">select.metric =</span> <span class="st">'AUC'</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cv =</span> <span class="st">"holdout"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cv.param =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="dv">2</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">thresh =</span> <span class="dv">1001</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">select.thresh =</span> <span class="fu">c</span>(<span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data check ... 
No presence column, presence-only data set is supposed.
Pseudo-absence selection will be computed.
   done. 

Pseudo absence selection... 
   random selection 
   done. 

Model evaluation...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   done. 

Model projection...
   done. 

Model axes contribution evaluation...
   done. </code></pre>
</div>
</div>
<ul>
<li><p>algorithm = ‘RF’: Especifica el algoritmo de Random Forest para modelar la distribución.</p></li>
<li><p>Env = HN_clim.current_raster: Las capas climáticas obtenidas previamente.</p></li>
<li><p>Occurrences = SETCHR1: Conjunto de datos de ocurrencia con las coordenadas de latitud y longitud.</p></li>
<li><p>Xcol = ‘LONGITUDE’, Ycol = ‘LATITUDE’: Especifica las columnas que contienen las coordenadas.</p></li>
<li><p>metric = ‘TSS’: Utiliza la métrica TSS para evaluar el modelo.</p></li>
<li><p>select.metric = ‘AUC’: Selección de la métrica AUC para determinar el umbral.</p></li>
<li><p>cv = “holdout”: Realiza una validación cruzada con partición holdout (70% entrenamiento, 30% validación).</p></li>
<li><p>cv.param = c(0.7, 2): Especifica el porcentaje para el entrenamiento y el número de pliegues.</p></li>
<li><p>thresh = 1001, select.thresh = c(0.75): Define el umbral para la selección de los modelos.</p></li>
</ul>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<p>Una vez ajustado el modelo, se evalúa su desempeño utilizando un conjunto de datos independiente (validación cruzada) o mediante medidas como el Área Bajo la Curva (AUC) de la curva ROC (Receiver Operating Characteristic), que indica cuán bien el modelo puede distinguir entre las áreas donde la especie está presente y las áreas donde no está.</p>
<p>También se puede utilizar la Kappa estadística para evaluar la concordancia entre las predicciones del modelo y los datos reales.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sdrf<span class="sc">@</span>evaluation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Threshold (Umbral)</li>
</ul>
<p>Significado: El umbral de probabilidad es el valor que se usa para decidir si una célula en el raster debe ser clasificada como “presencia” o “ausencia”. Si la probabilidad predicha es mayor que este umbral, se clasifica como presencia.</p>
<p>Valor recomendado: El umbral óptimo depende del contexto y del objetivo del modelo. En general, se elige para maximizar la relación entre sensibilidad y especificidad. Típicamente, el umbral se ajusta a 0.5, pero puede ser mayor o menor dependiendo de los objetivos del estudio (por ejemplo, en estudios de conservación, se podría preferir un umbral bajo para evitar la omisión de presencias).</p>
<ul>
<li><ol start="2" type="1">
<li>AUC (Área Bajo la Curva ROC)</li>
</ol></li>
</ul>
<p>Significado: La AUC mide la capacidad del modelo para discriminar entre las clases (presencia y ausencia). Un valor de 1 significa una discriminación perfecta, mientras que un valor de 0.5 indica un modelo que no discrimina mejor que el azar.</p>
<p>Valor recomendado: Un valor cercano a 1 (idealmente &gt; 0.8) es altamente deseable. Un AUC entre 0.7 y 0.8 todavía indica un buen modelo, pero valores menores de 0.7 pueden sugerir un modelo débil.</p>
<ul>
<li><ol start="3" type="1">
<li>Omission Rate (Tasa de Omisión)</li>
</ol></li>
</ul>
<p>Significado: La tasa de omisión mide el porcentaje de presencias que el modelo no logra predecir correctamente (es decir, los falsos negativos). Es el complemento de la sensibilidad.</p>
<p>Valor recomendado: Se recomienda una tasa de omisión baja, idealmente menos de 0.1. Valores más altos indican que el modelo no está identificando bien las áreas de presencia.</p>
<ul>
<li><ol start="4" type="1">
<li>Sensitivity (Sensibilidad)</li>
</ol></li>
</ul>
<p>Significado: La sensibilidad mide la capacidad del modelo para identificar correctamente las presencias (verdaderos positivos). Un valor cercano a 1 indica un modelo altamente sensible.</p>
<p>Valor recomendado: Un valor cercano a 1 (idealmente &gt; 0.8) es deseable, ya que indica que el modelo tiene una alta capacidad para identificar correctamente las presencias.</p>
<ul>
<li><ol start="5" type="1">
<li>Specificity (Especificidad)</li>
</ol></li>
</ul>
<p>Significado: La especificidad mide la capacidad del modelo para identificar correctamente las ausencias (verdaderos negativos). Un valor cercano a 1 indica que el modelo evita falsos positivos.</p>
<p>Valor recomendado: Se busca una especificidad alta, idealmente &gt; 0.9. Sin embargo, una especificidad razonable de 0.8 también es aceptable, dependiendo del contexto.</p>
<ul>
<li><ol start="6" type="1">
<li>Proporción Correcta (Prop. Correct)</li>
</ol></li>
</ul>
<p>Significado: La proporción correcta mide la proporción de predicciones correctas (tanto presencias como ausencias) con respecto al total de predicciones. Un valor cercano a 1 indica que el modelo tiene un alto nivel de precisión.</p>
<p>Valor recomendado: Un valor cercano a 1 (idealmente &gt; 0.9) es excelente, indicando que el modelo tiene una alta tasa de precisión.</p>
<ul>
<li><ol start="7" type="1">
<li>Kappa</li>
</ol></li>
</ul>
<p>Significado: El índice Kappa mide la concordancia entre las predicciones del modelo y las observaciones reales, ajustado por el azar. Un valor de Kappa cercano a 1 indica una excelente concordancia entre el modelo y los datos reales.</p>
<p>Valor recomendado: Un valor de Kappa &gt; 0.8 es excelente, entre 0.6 y 0.8 es bueno, y entre 0.4 y 0.6 es moderado. Valores menores indican una concordancia pobre.</p>
<ul>
<li><ol start="8" type="1">
<li>Calibration (Calibración)</li>
</ol></li>
</ul>
<p>Significado: La calibración mide cómo las probabilidades predichas por el modelo se ajustan a las observaciones reales. Un modelo bien calibrado es aquel cuya probabilidad de presencia predicha corresponde bien con la probabilidad real observada.</p>
<p>Valor recomendado: Se busca un valor de calibración cercano a 1. Idealmente, se debería obtener un valor &gt; 0.75. Sin embargo, en muchos casos, una calibración razonable de 0.7 a 0.75 puede ser aceptable.</p>
</div>
<div id="tabset-1-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-8-tab">
<p>Evaluación espacial: Comparar las predicciones del modelo con mapas de distribución conocidos y datos de campo adicionales para confirmar la precisión de las predicciones en áreas no muestreadas.</p>
<p>Ajustes del modelo: Si es necesario, los parámetros del modelo pueden ser ajustados para mejorar su precisión. Esto podría implicar la eliminación de variables no significativas o la inclusión de otras variables no consideradas inicialmente.</p>
</div>
<div id="tabset-1-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-9-tab">
<p>Una vez validado el modelo, se usa para predecir la distribución de la especie en áreas no muestreadas o para explorar escenarios de cambio, como el cambio climático. Esto permite identificar las áreas de mayor idoneidad ambiental para la especie, lo cual es clave para la conservación y manejo de la biodiversidad.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sdrf<span class="sc">@</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                wc2.1_30s_bio_3 wc2.1_30s_bio_7 wc2.1_30s_bio_8
Axes.evaluation         6.05946        13.16031        29.71138
                wc2.1_30s_bio_15 wc2.1_30s_bio_16 wc2.1_30s_bio_18
Axes.evaluation         13.00629         4.646024         28.82013
                wc2.1_30s_bio_19
Axes.evaluation         4.596405</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sdrf<span class="sc">@</span>projection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Clase6Parte1_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-10-tab">
<p>Los resultados se interpretan en términos ecológicos y se utilizan para tomar decisiones en la conservación, el manejo del hábitat y la planificación territorial.</p>
<p>Las predicciones también pueden usarse para identificar áreas prioritarias para la conservación de especies en peligro de extinción, áreas con alta biodiversidad o zonas donde se prevé que las especies puedan desplazar su distribución debido al cambio climático.</p>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HN%20Cursos%20publicidad/HN%20Biology%20Inv%20large.jpg" class="img-fluid figure-img"></p>
<figcaption>HN Biology Investigation Academy</figcaption>
</figure>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>